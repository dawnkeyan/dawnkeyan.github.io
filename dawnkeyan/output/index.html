<!DOCTYPE html>
<html lang="zh_cn">
<head>
<meta charset="utf-8">
<meta name="description" content="工作中的点点滴滴">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>晚起的虫子</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="zh_cn" href="rss.xml">
<link rel="canonical" href="https://dawnkeyan.github.io/">
<link rel="next" href="index-1.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]--><link rel="prefetch" href="posts/pythongong-ju-nikolatong-guo-rstwen-dang-sheng-chan-bo-ke-wang-ye-chuan-dao-githubfang-wen/" type="text/html">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">跳到主内容</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">展开导航栏</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://dawnkeyan.github.io/">

                <span id="blog-title">晚起的虫子</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">文章归档</a>
                </li>
<li>
<a href="categories/">标签</a>
                </li>
<li>
<a href="https://github.com/dawnkeyan">GitHub</a>
                </li>
<li>
<a href="https://dawnkeyan.github.io/posts/you-qing-lian-jie/">友情链接</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/pythongong-ju-nikolatong-guo-rstwen-dang-sheng-chan-bo-ke-wang-ye-chuan-dao-githubfang-wen/" class="u-url">python工具nikola通过rst文档生产博客网页传到github访问</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                dawnkeyan
            </span></p>
            <p class="dateline">
            <a href="posts/pythongong-ju-nikolatong-guo-rstwen-dang-sheng-chan-bo-ke-wang-ye-chuan-dao-githubfang-wen/" rel="bookmark">
            <time class="published dt-published" datetime="2020-02-29T09:44:05+08:00" itemprop="datePublished" title="2020-02-29 09:44">2020-02-29 09:44</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>由于mac会有python版本乱套问题，所以直接在python3 docker里安装部署</p>
<dl class="docutils">
<dt>安装nikola</dt>
<dd>pip install "git+https://github.com/getnikola/nikola#egg=Nikola[extras]"</dd>
<dt>包</dt>
<dd>git clone <a class="reference external" href="https://github.com/getnikola/nikola">https://github.com/getnikola/nikola</a>
</dd>
</dl>
<p>cd nikola</p>
<p>pip install -e ".[extras]"</p>
<dl class="docutils">
<dt>初始化项目</dt>
<dd>nikola init --demo &lt;directory_name&gt;.</dd>
<dt>生成文章</dt>
<dd>nikola new_post -e.</dd>
</dl>
<p>然后编辑文章</p>
<dl class="docutils">
<dt>构建</dt>
<dd>nikola build</dd>
<dt>启动服务浏览器访问</dt>
<dd>nikola serve --browser</dd>
</dl>
<p>可以根据喜好编辑conf.py</p>
<p>然后在github建个项目 git名称.github.io</p>
<p>clone到本地把Nikola项目拷在这 执行nikola build的目录的父目录，再把output里的全部目录拷到git项目的根目录</p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/macan-zhuang-impyla-thriftpyshi-bai/" class="u-url">mac安装impyla thriftpy失败</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                dawnkeyan
            </span></p>
            <p class="dateline">
            <a href="posts/macan-zhuang-impyla-thriftpyshi-bai/" rel="bookmark">
            <time class="published dt-published" datetime="2018-11-29T18:45:28+08:00" itemprop="datePublished" title="2018-11-29 18:45">2018-11-29 18:45</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>Command "/usr/local/opt/python/bin/python3.7 -u -c "import setuptools, tokenize;__file__='/private/tmp/pip-install-ocg0pik5/thriftpy/setup.py';f=getattr(tokenize, 'open', open)(__file__);code=f.read().replace('rn', 'n');f.close();exec(compile(code, __file__, 'exec'))" install --record /private/tmp/pip-record-2agxxtar/install-record.txt --single-version-externally-managed --compile" failed with error code 1 in /private/tmp/pip-install-ocg0pik5/thriftpy/</p>
<p>mac python Failed building wheel for thriftpy</p>
<p>解决办法：pip3 install cython thriftpy</p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/falcon/" class="u-url">安装python框架falcon</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                dawnkeyan
            </span></p>
            <p class="dateline">
            <a href="posts/falcon/" rel="bookmark">
            <time class="published dt-published" datetime="2018-11-29T13:50:07+08:00" itemprop="datePublished" title="2018-11-29 13:50">2018-11-29 13:50</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>docker run  -v $PWD/myapp:/usr/src/myapp  -it --rm -p 8000:8000 -w /usr/src/myapp python:3.5 bash
安装python和pip</p>
<p>$ pip install falcon</p>
<p>$ mkdir look
$ cd look</p>
<p>$touch app.py
import falcon
api = application = falcon.API()</p>
<p>$ pip install gunicorn</p>
<p>$ gunicorn -b 0.0.0.0:8000 app（默认是127.0.0.1:8000，这样的话只有主机可以访问）</p>
<p>$ curl localhost:8000 -v</p>
<p>$ pip install --upgrade httpie</p>
<p>$ http localhoost:8000</p>
<p>pip install msgpack-python</p>
<p>$ http GET localhost:8000/images</p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/phpba-shu-ju-zhuan-cheng-csvchuan-dao-solr/" class="u-url">php把数据转成csv传到solr</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                dawnkeyan
            </span></p>
            <p class="dateline">
            <a href="posts/phpba-shu-ju-zhuan-cheng-csvchuan-dao-solr/" rel="bookmark">
            <time class="published dt-published" datetime="2018-11-05T15:10:03+08:00" itemprop="datePublished" title="2018-11-05 15:10">2018-11-05 15:10</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <pre class="literal-block">
$field = ['Peter','Griffin','Oslo','Norway','id'];
$data = [
                  ['Peter'=&gt;43,'Griffin'=&gt;4,'Oslo'=&gt;32,'Norway'=&gt;23,'id'=&gt;1],//主键值必须有，比如这id等于1
                  ['Peter'=&gt;43,'Griffin'=&gt;5,'Oslo'=&gt;32,'Norway'=&gt;23,'id'=&gt;12],
                  ['Peter'=&gt;43,'Oslo'=&gt;32,'Norway'=&gt;23,'id'=&gt;51],
                  ['Peter'=&gt;43,'Griffin'=&gt;6,'Oslo'=&gt;32,'Norway'=&gt;23,'id'=&gt;31],
              ];
$core = 'test_update';
$csv_result = [$field];

      //处理数据，给不存在的值赋空值，不然CSV行列不对应
      foreach ($field as $files_value){
          foreach ($data as $data_key=&gt;$data_value){
              $csv_result[$data_key+1][$files_value] = $data_value[$files_value];
          }
      }


      $file_name = time().$core.rand().'.csv';

      $file = fopen($file_name,"w") or exit("Unable to open file!");;

      foreach ($csv_result as $line)
      {
          $line = implode(',',$line);
          fputcsv($file,split(',',$line));
      }
      fclose($file);

      //获取当前的路径
      exec('pwd',$address);

      //上传到solr
      exec('curl http://127.0.0.1:8984/solr/'.$core.'/update?commit=true --data-binary @'.$address[0].'/'.$file_name.' -H \'Content-type:text/csv; charset=utf-8\'',$result);
      //删除生成的文件
      unlink($file_name);
      $result = implode('',$result);

      //上传成功
      if(strpos($result,'&lt;int name="status"&gt;0&lt;/int&gt;')){
          return ['status'=&gt;true];
      }
      else{//上传失败
          //存日志到mongo
          $MongoModel = new MongoModel('集合', '', 'DB_MONGO');
          $MongoModel-&gt;add(['core'=&gt;$core,'msg'=&gt;$result,'field'=&gt;$field,'data'=&gt;$data]);
          return ['status'=&gt;false,'msg'=&gt;$result];
      }在这里书写你的文章。
</pre>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/centosda-jian-phphuan-jing/" class="u-url">centos搭建PHP环境</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                dawnkeyan
            </span></p>
            <p class="dateline">
            <a href="posts/centosda-jian-phphuan-jing/" rel="bookmark">
            <time class="published dt-published" datetime="2018-11-05T15:07:02+08:00" itemprop="datePublished" title="2018-11-05 15:07">2018-11-05 15:07</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>版权归作者所有，任何形式转载请联系作者。
作者：清晓（来自豆瓣）
来源：<a class="reference external" href="https://www.douban.com/note/683279363/">https://www.douban.com/note/683279363/</a></p>
<p>操作系统: CentOS 7.4 64位</p>
<p>创建组和账号</p>
<p>groupadd 组名
useradd -g 组名-s /bin/bash 账号
nginx（1.14.0）</p>
<p><a class="reference external" href="https://nginx.org/en/linux_packages.html#stable">https://nginx.org/en/linux_packages.html#stable</a></p>
<p>vim /etc/yum.repos.d/nginx.repo</p>
<p>[nginx]
name=nginx repo
baseurl=http://nginx.org/packages/centos/7/$basearch/
gpgcheck=0
enabled=1
sudo yum install nginx</p>
<p>站点配置文件位置 /etc/nginx</p>
<p>mysql（5.6.4）</p>
<p>yum install mysql  mysql-devel mysql-server</p>
<p>但是centost 安装mysql-server 会找不到包</p>
<p>办法：官网下载安装mysql-server</p>
<p>wget <a class="reference external" href="http://dev.mysql.com/get/mysql-community-release-el7-5.noarch.rpm">http://dev.mysql.com/get/mysql-community-release-el7-5.noarch.rpm</a></p>
<p>rpm -ivh mysql-community-release-el7-5.noarch.rpm</p>
<p>yum install mysql-community-server</p>
<p>安装好后重启  service mysqld restart</p>
<p>进入mysql mysql -u root</p>
<p>设置root密码</p>
<p>set password for <a class="reference external" href="mailto:'root'@'localhost">'root'@'localhost</a>' =password('xxxx');</p>
<p>修改配置文件</p>
<p>vim /etc/my.cnf</p>
<p>进入mysql</p>
<p>创建中小学账号 CREATE USER 'user'@'%' IDENTIFIED BY 'password'; （%可访问IP，%表示全部可访问）</p>
<p>创建数据库 create database 数据库名</p>
<p>授权账号数据库 grant all privileges on 数据库名.* to 账号@'%' identified by '密码';</p>
<p>刷新系统权限表 flush privileges;</p>
<p>可以使用的Navicat传输数据</p>
<p>mongo（3.6.x）</p>
<p><a class="reference external" href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-red-hat/index.html">https://docs.mongodb.com/manual/tutorial/install-mongodb-on-red-hat/index.html</a></p>
<p>vim /etc/yum.repos.d/mongodb-org-3.6.repo</p>
<p>[mongodb-org-3.6]
name=MongoDB Repository
baseurl=https://repo.mongodb.org/yum/redhat/$releasever/mongodb-org/3.6/x86_64/
gpgcheck=1
enabled=1
gpgkey=https://www.mongodb.org/static/pgp/server-3.6.asc
yum install -y mongodb-org</p>
<p>配置文件位置/etc/mongod.conf</p>
<p>MongoDB默认将数据文件存储在/var/lib/mongo目录，默认日志文件在/var/log/mongodb中。如果要修改, 可以把这两个文件放在空间大的硬盘 ，但是不要修改 /etc/mongod.conf ，我试过无法重启，应该是建软链接。</p>
<p>然后重启mongo</p>
<p>生成软连接</p>
<p>ln -s</p>
<p>相关命令service mongod start|stop|restart</p>
<p>mongo创建账号</p>
<p>use admin</p>
<p>db.createUser(</p>
<p>{</p>
<blockquote>
<p>user: "root",</p>
<p>pwd: "密码",</p>
<p>roles: [ { role: "userAdminAnyDatabase", db: "admin" } ]</p>
</blockquote>
<p>}</p>
<p>);</p>
<p>创建普通账号</p>
<p>use 数据库</p>
<p>db.createUser(</p>
<p>{</p>
<blockquote>
<p>user: "username",</p>
<p>pwd: "password",</p>
<p>roles: [ { role: "readWrite", db: "数据库名" } ]</p>
</blockquote>
<p>}</p>
<p>);</p>
<p>修改密码db.changeUserPassword('账号','密码');</p>
<p>还原数据mongorestore -d db 数据库名 数据库文件</p>
<p>卸载yum erase $(rpm -qa | grep mongodb-org)</p>
<p>删除数据库文件和日志文件</p>
<p>PHP（5.6.36）</p>
<p>1.检查当前安装的PHP包</p>
<p>yum list installed | grep php</p>
<p>如果有安装的PHP包，先删除他们</p>
<p>yum remove php.x86_64 php-cli.x86_64 php-common.x86_64 php-gd.x86_64 php-ldap.x86_64 php-mbstring.x86_64 php-mcrypt.x86_64 php-mysql.x86_64 php-pdo.x86_64</p>
<p>2.加载安装包</p>
<p>Centos 5.X</p>
<blockquote>
rpm -Uvh <a class="reference external" href="http://mirror.webtatic.com/yum/el5/latest.rpm">http://mirror.webtatic.com/yum/el5/latest.rpm</a>
</blockquote>
<p>CentOs 6.x</p>
<blockquote>
rpm -Uvh <a class="reference external" href="http://mirror.webtatic.com/yum/el6/latest.rpm">http://mirror.webtatic.com/yum/el6/latest.rpm</a>
</blockquote>
<p>CentOs 7.X</p>
<blockquote>
<p>rpm -Uvh <a class="reference external" href="https://mirror.webtatic.com/yum/el7/epel-release.rpm">https://mirror.webtatic.com/yum/el7/epel-release.rpm</a></p>
<p>rpm -Uvh <a class="reference external" href="https://mirror.webtatic.com/yum/el7/webtatic-release.rpm">https://mirror.webtatic.com/yum/el7/webtatic-release.rpm</a></p>
</blockquote>
<p>如果想删除上面安装的包，重新安装</p>
<p>rpm -qa | grep webstatic</p>
<p>rpm -e  上面搜索到的包即可</p>
<p>3.运行yum install</p>
<p>yum install php56w.x86_64 php56w-cli.x86_64 php56w-common.x86_64 php56w-gd.x86_64 php56w-ldap.x86_64 php56w-mbstring.x86_64 php56w-mcrypt.x86_64 php56w-mysql.x86_64 php56w-pdo.x86_64</p>
<p>注：如果想用其他版本。把所有56改成其他的</p>
<p>4.安装php-fpm</p>
<p>yum install php56w-fpm (其他版本对应改掉56)</p>
<p>[<a class="reference external" href="mailto:root@zhishu">root@zhishu</a> /]# whereis php  （查看安装路径）</p>
<p>php: /usr/bin/php /usr/lib64/php /etc/php.d /etc/php.ini /usr/share/php /usr/share/man/man1/php.1.gz</p>
<p>5.安装</p>
<p>yum install php56w-bcmath</p>
<p>5.安装mongodb扩展</p>
<p>先执行命令php -m 查看是否已有</p>
<p>mkdir /usr/local/php-mongodb</p>
<p>cd usr/local/php-mongodb/</p>
<p>wget <a class="reference external" href="http://pecl.php.net/get/mongo-1.6.12.tgz">http://pecl.php.net/get/mongo-1.6.12.tgz</a></p>
<p>tar xvzf mongo-1.6.12.tgz</p>
<p>cd mongo-1.6.12</p>
<p>phpize（如果没有php-devel会报错The php-devel package is required for use of this command.  安装php-devel  ：yum install php56w-devel）</p>
<p>./configure --with-php-config=/usr/bin/php-config</p>
<p>make &amp;&amp; make install</p>
<p>在php.ini文件中添加extension=mongo.so</p>
<p>extension=mongo.so</p>
<p>重启php-fpm或服务器</p>
<p>systemctl restart php-fpm</p>
<p>修改配置</p>
<p>vim /etc/php-fpm.d/www.conf</p>
<p>svn</p>
<p><a class="reference external" href="https://tecadmin.net/install-svn-1-9-on-centos/">https://tecadmin.net/install-svn-1-9-on-centos/</a></p>
<p>vim /etc/yum.repos.d/wandisco-svn.repo
[WandiscoSVN]
name=Wandisco SVN Repo
baseurl=http://opensource.wandisco.com/centos/$releasever/svn-1.10/RPMS/$basearch/
enabled=1
gpgcheck=0
yum -y install subversion</p>
<p>安装Java</p>
<p>下载安装包（也可以使用其他下载文件方式，拷过来的solr里如果已经有了就不用下载），因为认证问题，不能直接wget, 打开此页面 ，勾上Accept License Agreement，然后点击jdk-8u161-linux-x64.rpm,在下载页面获取文件下载地址，比如我本次的是http://download.oracle.com/otn-pub/java/jdk/8u161-b12/2f38c3b165be4555a1fa6e98c45e0808/jdk-8u161-linux-x64.rpm?AuthParam=1519538436_f233fa0ab4a9cba466bec47d360db37a，然后在/down目录下wget此地址。然后再重命名文件
mv jdk-8u161-linux-x64.rpm?AuthParam=1519538436_f233fa0ab4a9cba466bec47d360db37a jdk-8u161-linux-x64.rpm
安装
rpm -ivh jdk-8u161-linux-x64.rpm
配置系统环境变量，在/etc/profile里追加
JAVA_HOME=/usr/java/jdk1.8.0_161
JRE_HOME=$JAVA_HOME/jre
CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib
PATH=$JAVA_HOME/bin:$JRE_HOME/bin:$PATH
export PATH JAVA_HOME CLASSPATH
生效配置，并检验结果
source /etc/profile
java -version
nodejs (8.x)</p>
<p><a class="reference external" href="https://nodejs.org/en/download/package-manager/#enterprise-linux-and-fedora">https://nodejs.org/en/download/package-manager/#enterprise-linux-and-fedora</a></p>
<p>curl --silent --location <a class="reference external" href="https://rpm.nodesource.com/setup_8.x">https://rpm.nodesource.com/setup_8.x</a> | sudo bash -
sudo yum -y install nodejs
git (2.x)</p>
<p>通过IUS安装git 最新版</p>
<p>1.安装ius repository</p>
<p><a class="reference external" href="https://ius.io/GettingStarted/">https://ius.io/GettingStarted/</a></p>
<p>yum install <a class="reference external" href="https://centos7.iuscommunity.org/ius-release.rpm">https://centos7.iuscommunity.org/ius-release.rpm</a></p>
<p>2.安装yum-plugin-replace</p>
<p><a class="reference external" href="https://ius.io/Usage/#installing-ius-packages">https://ius.io/Usage/#installing-ius-packages</a></p>
<p>yum install yum-plugin-replace</p>
<p>3.安装git2u 替换老的git</p>
<p>yum replace git --replace-with git2u</p>
<p>openvpn(2.4.x)</p>
<p><a class="reference external" href="http://git.dev.backustech.com/apps/wiki/wikis/ubuntu16-%E5%AE%89%E8%A3%85-openvpn-2.4">http://git.dev.backustech.com/apps/wiki/wikis/ubuntu16-%E5%AE%89%E8%A3%85-openvpn-2.4</a></p>
<p>yum install openvpn</p>
<p>加高效云盘：</p>
<p>1.在阿里云创建云盘，然后挂载云盘</p>
<p>2.登录服务器执行fdisk -l 可以看到刚刚买的硬盘</p>
<p>3.对这块硬盘进行分区 fdisk /dev/vdb（/dev/vdb可能不一样）</p>
<p>4.然后执行fdisk -l 可以看到看到新的分区</p>
<p>5.格式化新分区（使用ext3扩展文件系统）</p>
<p>mkfs.ext3 /dev/vdb1</p>
<p>6.创建挂载目录mkdir data</p>
<p>7.挂载分区到目录</p>
<p>mount /dev/vdb1 /data</p>
<p>8.设置开机自动挂载 vim /etc/fstab</p>
<p>在文件最后加入/dev/vdb1        /data                   ext3  defaults    0 0</p>
<p>9.然后重启reboot（线上不要随便重启服务器，考虑实际情况可不可以重启）</p>
<p>10.用df就可以看到了</p>
<p>安装crontab</p>
<p>yum -y install vixie-cron</p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/solrshan-chu-shu-ju/" class="u-url">solr删除数据</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                dawnkeyan
            </span></p>
            <p class="dateline">
            <a href="posts/solrshan-chu-shu-ju/" rel="bookmark">
            <time class="published dt-published" datetime="2018-11-05T15:03:22+08:00" itemprop="datePublished" title="2018-11-05 15:03">2018-11-05 15:03</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>方法一 在solr页面选择对应的core，然后点击Document然后Document Type选择XML,然后在Document(s)框内填)</p>
<pre class="literal-block">
&lt;delete&gt;&lt;query&gt;*:*&lt;/query&gt;&lt;/delete&gt; #*:*可以改成其他条件
&lt;commit/&gt;
</pre>
<p>方法二 post 请求http://ip:端口/solr/core/update?wt=json，&lt;query&gt;id:1&lt;/query&gt;里的条件可以修改，post参数</p>
<pre class="literal-block">
&lt;add commitWithin="1000" overwrite="true"&gt;
  &lt;delete&gt;
      &lt;query&gt;id:1&lt;/query&gt;
  &lt;/delete&gt;
  &lt;commit&gt;&lt;/commit&gt;
&lt;/add&gt;
</pre>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/solrdao-mongoshu-ju-liu-cheng/" class="u-url">solr导mongo数据流程</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                dawnkeyan
            </span></p>
            <p class="dateline">
            <a href="posts/solrdao-mongoshu-ju-liu-cheng/" rel="bookmark">
            <time class="published dt-published" datetime="2018-11-05T15:01:05+08:00" itemprop="datePublished" title="2018-11-05 15:01">2018-11-05 15:01</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>1.进入/home/solr/solr-6.6.2（solr安装路径）创建core，比如创建lab_cloud_periodical bin/solr create -c core名 -p 端口号 -force（root用户需要加）</p>
<p>2.导出mongodb csv 比如导出lab，-f是需要放在solr的且此集合有的字段 mongoexport --username 用户名 --password 密码 --type=csv -f _id,title -d 数据库 -c 集合 -o /home/文件名.csv</p>
<p>3.把数据传到solrcurl <a class="reference external" href="http://ip">http://ip</a>:端口号/solr/core/update?commit=true --data-binary @/home/文件名.csv -H 'Content-type:text/csv; charset=utf-8'</p>
<p>问题： 可能执行着会报错，那是solr会给字段定义类型，但你的某些值有不是那个类型，比如给你定义了int,然后你传的值是字符串。解决办法就是去把int改成string，位置在vim /home/solr/solr-6.6.2/server/solr/lab（写core名）/conf/managed-schema,比如这的tid(有些是默认给你设置了时间，但你传入的不是时间格式)，这是我遇到的问题，有些配置想改都可以改的。然后重新导入数据，还有就是主键可以重新设置，修改&lt;uniqueKey&gt;id&lt;/uniqueKey&gt;</p>
<p>4.如果需要删除数据参考：<a class="reference external" href="http://blog.csdn.net/lbf5210/article/details/51207043">http://blog.csdn.net/lbf5210/article/details/51207043</a></p>
<p>5.查询，页面参数解释：<a class="reference external" href="http://blog.csdn.net/zhufenglonglove/article/details/51518846">http://blog.csdn.net/zhufenglonglove/article/details/51518846</a> 浏览器进入http://ip:端口号/solr</p>
<p>6.目前能弄的mongo实时更新是一个core记录整个库，一个集合一个core不知道咋弄。</p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/centos-an-zhuang-solr/" class="u-url">centos 安装solr</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                dawnkeyan
            </span></p>
            <p class="dateline">
            <a href="posts/centos-an-zhuang-solr/" rel="bookmark">
            <time class="published dt-published" datetime="2018-11-05T14:45:40+08:00" itemprop="datePublished" title="2018-11-05 14:45">2018-11-05 14:45</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>1.安装jdk</p>
<p>下载安装包（也可以使用其他下载文件方式），因为认证问题，不能直接wget, 打开此页面 ，在Java SE Development Kit 8u161勾上Accept License Agreement，然后点击jdk-8u161-linux-x64.rpm,在下载页面获取文件下载地址，比如我本次的是http://download.oracle.com/otn-pub/java/jdk/8u161-b12/2f38c3b165be4555a1fa6e98c45e0808/jdk-8u161-linux-x64.rpm?AuthParam=1519538436_f233fa0ab4a9cba466bec47d360db37a，然后在/down目录下wget此地址。然后再重命名文件
mv jdk-8u161-linux-x64.rpm?AuthParam=1519538436_f233fa0ab4a9cba466bec47d360db37a jdk-8u161-linux-x64.rpm</p>
<p>安装
rpm -ivh jdk-8u161-linux-x64.rpm</p>
<p>配置系统环境变量，在/etc/profile里追加</p>
<pre class="literal-block">
JAVA_HOME=/usr/java/jdk1.8.0_161
JRE_HOME=$JAVA_HOME/jre
CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib
PATH=$JAVA_HOME/bin:$JRE_HOME/bin:$PATH
export PATH JAVA_HOME CLASSPATH
</pre>
<p>生效配置，并检验结果</p>
<pre class="literal-block">
source /etc/profile
java -version
</pre>
<p>2.安装solr</p>
<p>安装前检测rng-tools及lsof是否正确安装(安装成功输入命令后显示版本号)</p>
<pre class="literal-block">
rpm -qa |grep rng-tools
rpm -qa |grep lsof
</pre>
<p>若未安装，设备能够联网的情况下，可使用如下命令安装，否则自行下载安装包安装</p>
<pre class="literal-block">
yum install rng-tools
yum install lsof
</pre>
<p>配置rng-tools</p>
<pre class="literal-block">
echo 'EXTRAOPTIONS="--rng-device /dev/urandom"' &gt;/etc/sysconfig/rngd
service rngd start
chkconfig rngd on
</pre>
<p>在down目录下创建solr,下载solr安装包,下载apache-tomcat安装包（如果找不到页面，则在浏览器打开https://tomcat.apache.org/download-80.cgi查看有的版本号，然后修改版本号），然后使用tar -zxvf命令解压两个文件</p>
<pre class="literal-block">
#下载solr安装包
wget http://mirror.bit.edu.cn/apache/lucene/solr/6.6.2/solr-6.6.2.tgz
#下载apache-tomcat安装包（如果找不到页面，则在浏览器打开https://tomcat.apache.org/download-80.cgi查看有的版&gt;本号，然后修改版本号）
wget http://mirror.bit.edu.cn/apache/tomcat/tomcat-8/v8.0.50/bin/apache-tomcat-8.0.50.tar.gz
</pre>
<p>3.配置solr</p>
<p>使用tar -zxvf命令解压刚刚下载的solr安装包和下载apache-tomcat安装包</p>
<pre class="literal-block">
tar -zxvf solr-6.6.2.tgz
tar -zxvf apache-tomcat-8.0.50.tar.gz
</pre>
<p>在solr-6.6.2目录下拷贝dataimporthandler的jar包</p>
<pre class="literal-block">
cp dist/solr-dataimporthandler-* server/solr-webapp/webapp/WEB-INF/lib/
</pre>
<p>在/down/solr目录下载mysql-connector-java-5.1.45安装包</p>
<pre class="literal-block">
wget https://dev.mysql.com/get/Downloads/Connector-J/mysql-connector-java-5.1.45.tar.gz
</pre>
<p>解压mysql-connector-java-5.1.45.tar.gz</p>
<pre class="literal-block">
tar -zxvf mysql-connector-java-5.1.45.tar.gz
</pre>
<p>拷贝mysql-connector-java</p>
<pre class="literal-block">
cp mysql-connector-java-5.1.45/mysql-connector-java-5.1.45-bin.jar solr-6.6.2/server/solr-webapp/webapp/WEB-INF/lib/
</pre>
<p>在/down/solr目录下载ikanalyzer安装包</p>
<pre class="literal-block">
wget https://github.com/zxiaofan/ik-analyzer-solr6/releases/download/6.6.0/ikanalyzer-6.6.0.jar
</pre>
<p>解压ikanalyzer</p>
<pre class="literal-block">
jar -xvf ikanalyzer-6.6.0.jar
</pre>
<p>拷贝ikanalyzer</p>
<pre class="literal-block">
cp ikanalyzer-6.6.* solr-6.6.2/server/solr-webapp/webapp/WEB-INF/lib/
</pre>
<p>在/down/solr目录下载pinyin4j</p>
<pre class="literal-block">
wget https://github.com/zxiaofan/ik-analyzer-solr6/releases/download/6.6.0/pinyin4j_IKconfig.zip
</pre>
<p>复制文件</p>
<pre class="literal-block">
unzip pinyin4j_IKconfig.zip -d pinyin4j
cp pinyin4j/pinyin*.jar solr-6.6.2/server/solr-webapp/webapp/WEB-INF/lib/
mkdir solr-6.6.2/server/solr-webapp/webapp/WEB-INF/classes
cp pinyin4j/ext.dic solr-6.6.2/server/solr-webapp/webapp/WEB-INF/classes/
cp pinyin4j/IKAnalyzer.cfg.xml solr-6.6.2/server/solr-webapp/webapp/WEB-INF/classes/
cp pinyin4j/stopword.dic solr-6.6.2/server/solr-webapp/webapp/WEB-INF/classes/
</pre>
<p>修改配置solr-6.6.2/server/solr-webapp/webapp/WEB-INF/classes/IKAnalyzer.cfg.xml加入新的内容</p>
<pre class="literal-block">
&lt;!--词典动态更新时间间隔[首次延时,时间间隔]（格式：正整数，单位：分钟）--&gt;
&lt;entry key="dic_updateMin"&gt;1,1&lt;/entry&gt;

&lt;!--禁用内置主词典main2012.dic（默认false）--&gt;
&lt;!--&lt;entry key="dicInner_disable"&gt;true&lt;/entry&gt; --&gt;
</pre>
<p>修改时区，修改solr-6.6.2/bin/solr.in.sh中的SOLR_TIMEZONE="UTC+8"</p>
<p>4.创建core并配置</p>
<p>进入solr-6.6.2目录，执行创建名称为goods的core,如果无法确定实例端口，加上-p 端口号，如果在root用户下启动solr存在风险，要么换个账号，要么加上 -force</p>
<pre class="literal-block">
bin/solr create -c goods -p 8983 -force
</pre>
<p>修改配置：修改server/solr/goods/conf目录下的solrconfig.xml,data-config.xml,managed-schema的文件，没有就新建</p>
<pre class="literal-block">
#solrconfig.xml添加内容（在&lt;/config&gt;之前）
&lt;requestHandler name="/dataimport" class="org.apache.solr.handler.dataimport.DataImportHandler"&gt;
  &lt;lst name="defaults"&gt;
      &lt;str name="config"&gt;data-config.xml&lt;/str&gt;
  &lt;/lst&gt;
&lt;/requestHandler&gt;

#data-config.xml添加内容
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;dataConfig&gt;
  &lt;dataSource
      name="dbSource"
      type="JdbcDataSource"
      driver="com.mysql.jdbc.Driver"
      url="jdbc:mysql://数据库地址:端口号/数据库名称"
      batchSize="-1"
      user="用户名"
      password="密码"
      readOnly="true"
      autoCommit="true"
      netTimeoutForStreamingResults="0"
      /&gt;
  &lt;document&gt;
      &lt;entity name="goods" dataSource="dbSource" onError="skip" pk="id" query="select id,address-detail,create_time from lab_model_address"
          deltaImportQuery="select id,address-detail,create_time from lab_model_address where id = '${dih.delta.id}'"
          deltaQuery="select id,address-detail,create_time from lab_model_address where create_time &gt; unix_timestamp('${dataimporter.last_index_time}')"&gt;
          &lt;field column="id" name="id" /&gt;
          &lt;field column="address-detail" name="address-detail" /&gt;
          &lt;field column="create_time" name="create_time" /&gt;
      &lt;/entity&gt;
  &lt;/document&gt;
&lt;/dataConfig&gt;

#managed-schema添加内容（在&lt;field name="id" ... /&gt;之后）
&lt;field name="address-detail" type="text_ik" indexed="true" stored="true"/&gt;
  &lt;fieldType name="text_pinyin" class="solr.TextField" positionIncrementGap="0"&gt;
      &lt;analyzer type="index"&gt;
          &lt;tokenizer class="org.wltea.analyzer.lucene.IKTokenizerFactory"/&gt;
          &lt;filter class="solr.SynonymGraphFilterFactory" synonyms="synonyms.txt" ignoreCase="true" expand="true" /&gt;
          &lt;filter class="com.shentong.search.analyzers.PinyinTransformTokenFilterFactory" minTermLenght="2" /&gt;
          &lt;filter class="com.shentong.search.analyzers.PinyinNGramTokenFilterFactory" minGram="1" maxGram="20" /&gt;
      &lt;/analyzer&gt;
      &lt;analyzer type="query"&gt;
          &lt;tokenizer class="org.wltea.analyzer.lucene.IKTokenizerFactory"/&gt;
          &lt;filter class="solr.SynonymGraphFilterFactory" synonyms="synonyms.txt" ignoreCase="true" expand="true" /&gt;
          &lt;filter class="solr.LowerCaseFilterFactory" /&gt;
      &lt;/analyzer&gt;
  &lt;/fieldType&gt;
  &lt;fieldType name="text_ik" class="solr.TextField"&gt;
      &lt;analyzer type="index" useSmart="false" isMaxWordLength="false" &gt;
          &lt;tokenizer class="org.wltea.analyzer.lucene.IKTokenizerFactory"/&gt;
          &lt;filter class="solr.SynonymGraphFilterFactory" synonyms="synonyms.txt" ignoreCase="true" expand="true"/&gt;
      &lt;/analyzer&gt;
      &lt;analyzer type="query" useSmart="true" isMaxWordLength="true" &gt;
          &lt;tokenizer class="org.wltea.analyzer.lucene.IKTokenizerFactory"/&gt;
          &lt;filter class="solr.SynonymGraphFilterFactory" synonyms="synonyms.txt" ignoreCase="true" expand="true"/&gt;
      &lt;/analyzer&gt;
  &lt;/fieldType&gt;
  &lt;field name="title_ik" type="text_ik" indexed="true" required="true" stored="true"/&gt;
  &lt;copyField source="address-detail" dest="title_ik"/&gt;
  &lt;field name="create_time" type="int" indexed="true" stored="true"/&gt;
  &lt;field name="pinyin" type="text_pinyin" indexed="true" stored="true"/&gt;
  &lt;copyField source="address-detail" dest="pinyin"/&gt;
</pre>
<p>5.启动，停止,重启solr</p>
<pre class="literal-block">
bin/solr stop -all
bin/solr start -force
bin/solr stop -all; bin/solr start -force
</pre>
<p>6.导入数据</p>
<p>浏览器中访问http://IP:8983/, 查看CoreAdmin中是否存在创建的core:goods
Core Selector选择新建的core（如goods），选择Dataimport，Command选择full-import，Start, Rows选择合理值，点击Excute执行数据导入</p>
<p>7.验证数据是否导入:接上一步中选择Query，直接点击Execute Query查看结果</p>
<p>8.验证分词是否可用:接上一步中选择Analysis，输入值，类型选择text_ik，查看分词结果（需要分词的数据类型在managed-schema中field的type为text_ik类型。</p>
<p>9.添加批处理任务(apache-solr-dataimporthandler-.jar可以在 我的GitHub下载 )</p>
<p>将apache-solr-dataimporthandler-.jar放到solr-6.6.2/server/solr-webapp/webapp/WEB-INF/lib/
在solr-6.6.2/server/solr-webapp/webapp/WEB-INF/web.xml中的&lt;/web-app&gt;之前加入下面代码</p>
<pre class="literal-block">
&lt;listener&gt;
 &lt;listener-class&gt;org.apache.solr.handler.dataimport.scheduler.ApplicationListener&lt;/listener-class&gt;
&lt;/listener&gt;

在solr-6.6.2/server/solr/conf中新建dataimport.properties，文件夹不存在时新建
#################################################
#                                               #
#       dataimport scheduler properties         #
#                                               #
#################################################

#  to sync or not to sync
#  1 - active; anything else - inactive
syncEnabled=1

#  which cores to schedule
#  in a multi-core environment you can decide which cores you want syncronized
#  leave empty or comment it out if using single-core deployment
syncCores=goods,goods-test

#  solr server name or IP address
#  [defaults to localhost if empty]
server=localhost

#  solr server port
#  [defaults to 80 if empty]
port=8983

#  application name/context
#  [defaults to current ServletContextListener's context (app) name]
webapp=solr

#  URL params [mandatory]
#  remainder of URL
#增量
params=/dataimport?command=delta-import&amp;clean=false&amp;commit=true&amp;optimize=false&amp;wt=json&amp;indent=true&amp;entity=goods&amp;verbose=false&amp;debug=false

#  schedule interval
#  number of minutes between two runs
#  [defaults to 30 if empty]
interval=20

#  重做索引的时间间隔，单位分钟，默认7200，即1天;
#  为空,为0,或者注释掉:表示永不重做索引
reBuildIndexInterval=7200

#  重做索引的参数
reBuildIndexParams=/dataimport?command=full-import&amp;clean=true&amp;commit=true&amp;optimize=true&amp;wt=json&amp;indent=true&amp;entity=goods&amp;verbose=false&amp;debug=false

#  重做索引时间间隔的计时开始时间，第一次真正执行的时间=reBuildIndexBeginTime+reBuildIndexInterval*60*1000；
#  两种格式：2012-04-11 03:10:00 或者  03:10:00，后一种会自动补全日期部分为服务启动时的日期
reBuildIndexBeginTime=09:00:00
</pre>
<p>10.重启solr</p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/gitcao-zuo/" class="u-url">git操作</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                dawnkeyan
            </span></p>
            <p class="dateline">
            <a href="posts/gitcao-zuo/" rel="bookmark">
            <time class="published dt-published" datetime="2018-11-05T14:30:35+08:00" itemprop="datePublished" title="2018-11-05 14:30">2018-11-05 14:30</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>复制</p>
<p>git checkout master</p>
<p>git pull</p>
<p>git checkout -b 新分支名</p>
<p>git push origin 新分支名</p>
<dl class="docutils">
<dt>删除分支</dt>
<dd>git push origin --delete 20180829</dd>
<dt>push后回退</dt>
<dd>
<p class="first">git revert 版本号
git push origin 分支名</p>
<p class="last">合并某分支到当前分支：git merge &lt;name&gt; 在这里书写你的文章。</p>
</dd>
</dl>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/ssl/" class="u-url">ssl</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                dawnkeyan
            </span></p>
            <p class="dateline">
            <a href="posts/ssl/" rel="bookmark">
            <time class="published dt-published" datetime="2018-11-04T20:48:32+08:00" itemprop="datePublished" title="2018-11-04 20:48">2018-11-04 20:48</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>http传输是明文的，可以拦截进行修改等等的操作，及其不安全。ssl对http进行包裹，让别人不容易拦截偷窥，组合成https</p>
<p>在进行数据传输前，进行相关的验证生成相应的密钥，验证后面的相互请求是否可靠。</p>
<p>密钥使用的算法有对称加密和非对称加密，对称加密更快，非对称加密更复杂且更慢</p>
<p>https因为在http上做了一层ssl操作，所以要慢一点。</p>
</div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="next">
                <a href="index-1.html" rel="next">以前的文章</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2020         <a href="mailto:dawnkeyan@126.com">dawnkeyan</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("zh-cn");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
